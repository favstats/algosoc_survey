---
title: Spending
description-meta: "How do political parties chase your vote, what do they want to keep hidden, and how much money do they spend on it? In the lead-up to the elections, we monitor political microtargeting."
format: 
  html:
    page-layout: custom
---

```{r setup, include=FALSE}
# here::i_am("wtm_gb.Rproj")


## Global options
knitr::opts_chunk$set(
    cache = F,
    echo = F,
    warning = F,
    message = F,
    cache.lazy = FALSE
)


pacman::p_load(htmltools, tidyverse, highcharter, gt, gtExtras, rvest, haven)

options(scipen = 999)
```


```{r echo=FALSE, results='asis'}

shiny::HTML(glue::glue('
<style>
#overlay {
  position: fixed;
  display: none;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0,0,0,0.5);
  z-index: 2;
  cursor: pointer;
  text-align: center;
  padding-top: 10%;
}

#text {
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 20px;
  color: black;
  transform: translate(-50%,-50%);
  -ms-transform: translate(-50%,-50%);
  background-color: white;
  padding: 20px;
  border-radius: 10px;
  width: 50%;
}
</style>

<div id="overlay" onclick="off()">
  <div id="text">
    <img src="algosoclogo.jpg" alt="Logo" style="width:150px;height:150px;">
    <h2>Welcome to the AlgoSoc Survey Dashboard</h2>
    <p>This dashboard aggregates data collected via the <a href="https://algosoc.org/" target="_blank">AlgoSoc Consortium</a> to show how citizens think and feel about AI in society.</p>
    <p>If you want to know more about AlgoSoc and our work on AI, visit us on <a href="https://algosoc.org/" target="_blank">algosoc.org</a>!</p>
  </div>
</div>

<script>
window.onload = function() {
  var popupLastShown = localStorage.getItem("popupLastShown");
  var now = new Date().getTime();

  if (!popupLastShown || now - popupLastShown > 60*60*1000) {  // 60*60*1000 milliseconds = 1 hour
    document.getElementById("overlay").style.display = "block";
    localStorage.setItem("popupLastShown", now);
  }
}

function off() {
  document.getElementById("overlay").style.display = "none";
}
</script>
', .open = ">>>", .close = "<<<"))




```

# {.sidebar}

```{=html}
<!-- Sidebar -->
<div id="sidebar" style="width: 250px; height: 100%; background: #f4f4f4; position: fixed; left: -250px; top: 0; transition: 0.3s;">
  <a href="javascript:void(0)" onclick="toggleSidebar()" style="padding: 10px; text-align: right; display: block; color: black;">Close &times;</a>
  <h3>Sidebar Content</h3>
  <p>This is your sidebar content. Add links, text, or images here.</p>
</div>

<!-- Page Content -->
<div style="margin-left: 25px; transition: margin-left 0.3s;">
  <button onclick="toggleSidebar()">Open Sidebar</button>
  <h2>Main Content</h2>
  <p>This is the main content of your page. Add your text, data visualizations, or other elements here.</p>
</div>
{=html}
Copy code
<!-- JavaScript to Toggle the Sidebar -->
<script>
function toggleSidebar() {
  var sidebar = document.getElementById("sidebar");
  if (sidebar.style.left === '-250px') {
    sidebar.style.left = '0';
    document.body.style.marginLeft = "250px";
  } else {
    sidebar.style.left = '-250px';
    document.body.style.marginLeft = "0";
  }
}
</script>
```

```{ojs, include = F}
viewof bill_length_min = Inputs.range(
  [32, 50], 
  {value: 35, step: 1, label: "Bill length (min):"}
)
viewof islands = Inputs.checkbox(
  ["Torgersen", "Biscoe", "Dream"], 
  { value: ["Torgersen", "Biscoe"], 
    label: "Islands:"
  }
)
```

# Graphs    


```{r include=FALSE}
# print(getwd())
# here::here("")
# prCint(getwd())
# hcoptslang <- getOption("highcharter.lang")
# 
# hcoptslang$shortMonths <- c("Jan", "Feb", "Mrt", "Apr", "Mei", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dec")
# 
# options(highcharter.lang = hcoptslang)

data <- read_sav("../L_AlgoSoc_wave1_1.0p.sav")

var_labels <- c(
  "People from the general population",
  "Members of Parliament",
  "Judges",
  "Journalists",
  "Police officers",
  "Doctors",
  "Friends/family",
  "Yourself"
)
std.error <- function(x) sd(x, na.rm =T)/sqrt(length(x))

confidence <- data %>% 
  select(CONF1:CONF8) %>% 
  gather() %>% 
  group_by(key) %>% 
  summarize(mean_val = mean(value, na.rm =T),
            sd_val = std.error(value)) %>% 
  ungroup() %>% 
  mutate(varlabs = var_labels)

```

How confident are you that the following groups can tell the difference between content created by AI and content created by people?

```{r}

hchart(
  confidence, 
  "column",
  hcaes(x = varlabs, y = mean_val)#,
  # hcaes(x = key, y = mean_val, group = Type),
  # id = c("a", "b", "c")
  ) %>%
  
  hc_add_series(
    confidence,
    "errorbar", 
    hcaes(y = mean_val, 
          x = varlabs, low = mean_val - sd_val, 
          high = mean_val + sd_val),
    # hcaes(y = mean_val, x = key, low = mean_val - sd_val, high = mean_val + sd_val, group = Type),
    # linkedTo = c("a", "b", "c"),
    enableMouseTracking = TRUE,
    showInLegend = FALSE
    ) %>% 
  highcharter::hc_plotOptions(
    errorbar = list(
      color = "black", 
      # whiskerLength = 1,
      stemWidth = 1
    ) 
  ) 
```




```{r}

confidence_ages <- data %>% #table()
  mutate(age_groups = case_when(
    leeftijd %in% 16:17 ~ "<18",
    leeftijd %in% 18:24 ~ "18-24",
    leeftijd %in% 25:34 ~ "25-34",
    leeftijd %in% 35:44 ~ "35-44",
    leeftijd %in% 45:54 ~ "45-54",
    leeftijd %in% 55:64 ~ "55-64",
    leeftijd %in% 65:150 ~ "65+",
  )) %>% 
  select(CONF1:CONF8, age_groups) %>% 
  gather(key, value, -age_groups) %>% 
  group_by(key, age_groups) %>% 
  summarize(mean_val = mean(value, na.rm =T),
            sd_val = std.error(value)) %>% 
  ungroup() %>% 
  mutate(varlabs = case_when(
    key  == "CONF1" ~ var_labels[1],
    key  == "CONF2" ~ var_labels[2],
    key  == "CONF3" ~ var_labels[3],
    key  == "CONF4" ~ var_labels[4],
    key  == "CONF5" ~ var_labels[5],
    key  == "CONF6" ~ var_labels[6],
    key  == "CONF7" ~ var_labels[7],
    key  == "CONF8" ~ var_labels[8]
  ))
  # mutate(varlabs = var_labels)

hchart(
  confidence_ages, 
  "column",
  # hcaes(x = varlabs, y = mean_val),
  hcaes(x = varlabs, y = mean_val, group = age_groups),
  id = c("a", "b", "c", "d", "e", "f", "g")
  ) %>%
  
  hc_add_series(
    confidence_ages,
    "errorbar", 
    hcaes(y = mean_val, 
          x = varlabs, low = mean_val - sd_val, 
          high = mean_val + sd_val,
          group = age_groups),
    # hcaes(y = mean_val, x = key, low = mean_val - sd_val, high = mean_val + sd_val, group = Type),
    linkedTo = c("a", "b", "c", "d", "e", "f", "g"),
    enableMouseTracking = TRUE,
    showInLegend = FALSE
    ) %>% 
  highcharter::hc_plotOptions(
    errorbar = list(
      color = "black", 
      # whiskerLength = 1,
      stemWidth = 1
    ) 
  ) 
```
